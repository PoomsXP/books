<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF Flipbook Viewer</title>
  <style>
    body {
      background: #f2f2f2;
      font-family: Arial, sans-serif;
      margin: 0; padding: 20px;
      display: flex;
      justify-content: center;
    }
    #flipbook {
      width: 800px;
      height: 600px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      background: white;
    }
  </style>
</head>
<body>

  <div id="flipbook"></div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- Turn.js -->
  <script src="https://cdn.jsdelivr.net/npm/turn.js@4.1.0/turn.min.js"></script>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <script>
    // Setup workerSrc for PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

    // Get URL parameter helper
    function getQueryParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    // Render one page of PDF to canvas
    async function renderPage(pdf, pageNum) {
      const page = await pdf.getPage(pageNum);
      const viewport = page.getViewport({ scale: 1.5 });
      const canvas = document.createElement("canvas");
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      const ctx = canvas.getContext("2d");
      await page.render({ canvasContext: ctx, viewport: viewport }).promise;
      return canvas;
    }

    // Load PDF and create flipbook
    async function loadFlipbook(pdfUrl) {
      try {
        const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
        const flipbook = $("#flipbook");
        const pages = [];

        for (let i = 1; i <= pdf.numPages; i++) {
          const canvas = await renderPage(pdf, i);
          const pageDiv = $("<div></div>").css({
            width: canvas.width,
            height: canvas.height,
            overflow: "hidden"
          }).append(canvas);
          pages.push(pageDiv);
        }

        flipbook.append(pages);

        flipbook.turn({
          width: pages[0].width() * 2,
          height: pages[0].height(),
          autoCenter: true,
          elevation: 50,
          gradients: true,
        });
      } catch (e) {
        alert("Failed to load PDF: " + e.message);
        console.error(e);
      }
    }

    // Initialize on DOM ready
    $(function () {
      const pdfUrl = getQueryParam("pdf");
      const title = getQueryParam("title");

      if (title) {
        document.title = decodeURIComponent(title);
      }

      if (!pdfUrl) {
        alert("No PDF specified. Add ?pdf=URL to the viewer.html");
        return;
      }

      loadFlipbook(decodeURIComponent(pdfUrl));
    });
  </script>
</body>
</html>
